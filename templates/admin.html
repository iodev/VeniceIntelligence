{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-5 mb-4">Admin Dashboard</h1>
        <p class="lead">View and manage AI model information across different platforms</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">API Health Status</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">Venice.ai API</h5>
                                <div class="mt-3">
                                    {% if api_status.venice %}
                                        <span class="badge bg-success p-2"><i class="bi bi-check-circle me-1"></i> Available</span>
                                    {% else %}
                                        <span class="badge bg-danger p-2"><i class="bi bi-x-circle me-1"></i> Unavailable</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">Perplexity API</h5>
                                <div class="mt-3">
                                    {% if api_status.perplexity %}
                                        <span class="badge bg-success p-2"><i class="bi bi-check-circle me-1"></i> Available</span>
                                    {% else %}
                                        <span class="badge bg-danger p-2"><i class="bi bi-x-circle me-1"></i> Unavailable</span>
                                        {% if not api_keys.perplexity %}
                                            <p class="small text-muted mt-2">API key not configured</p>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">Anthropic API</h5>
                                <div class="mt-3">
                                    {% if api_status.anthropic %}
                                        <span class="badge bg-success p-2"><i class="bi bi-check-circle me-1"></i> Available</span>
                                    {% else %}
                                        <span class="badge bg-danger p-2"><i class="bi bi-x-circle me-1"></i> Unavailable</span>
                                        {% if not api_keys.anthropic %}
                                            <p class="small text-muted mt-2">API key not configured</p>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <h5 class="card-title">Qdrant</h5>
                                <div class="mt-3">
                                    {% if api_status.qdrant %}
                                        <span class="badge bg-success p-2"><i class="bi bi-check-circle me-1"></i> Available</span>
                                    {% else %}
                                        <span class="badge bg-danger p-2"><i class="bi bi-x-circle me-1"></i> Unavailable</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Model Information Tabs -->
<ul class="nav nav-tabs" id="modelTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="venice-tab" data-bs-toggle="tab" data-bs-target="#venice" type="button" role="tab" aria-controls="venice" aria-selected="true">
            Venice.ai
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="perplexity-tab" data-bs-toggle="tab" data-bs-target="#perplexity" type="button" role="tab" aria-controls="perplexity" aria-selected="false">
            Perplexity
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="anthropic-tab" data-bs-toggle="tab" data-bs-target="#anthropic" type="button" role="tab" aria-controls="anthropic" aria-selected="false">
            Anthropic
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="mistral-tab" data-bs-toggle="tab" data-bs-target="#mistral" type="button" role="tab" aria-controls="mistral" aria-selected="false">
            Mistral
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="performance-tab" data-bs-toggle="tab" data-bs-target="#performance" type="button" role="tab" aria-controls="performance" aria-selected="false">
            Performance Metrics
        </button>
    </li>
</ul>
<div class="tab-content p-3 border border-top-0 rounded-bottom mb-4" id="modelTabsContent">
    <!-- Venice.ai Models -->
    <div class="tab-pane fade show active" id="venice" role="tabpanel" aria-labelledby="venice-tab">
        <h4 class="mb-4">Venice.ai Models</h4>
        <div class="row">
            <div class="col-12">
                {% if venice_models %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Model ID</th>
                                <th>Display Name</th>
                                <th>Type</th>
                                <th>Context Window</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in venice_models %}
                            <tr>
                                <td><code>{{ model.id }}</code></td>
                                <td>{{ model.name }}</td>
                                <td>{{ model.type }}</td>
                                <td>{{ model.context_length|default('Unknown', true) }}</td>
                                <td>
                                    {% if model.is_available %}
                                    <span class="badge bg-success">Available</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Unavailable</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i> No Venice.ai models found or API unavailable
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Perplexity Models -->
    <div class="tab-pane fade" id="perplexity" role="tabpanel" aria-labelledby="perplexity-tab">
        <h4 class="mb-4">Perplexity Models</h4>
        <div class="row">
            <div class="col-12">
                {% if api_status.perplexity and perplexity_models %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Model ID</th>
                                <th>Display Name</th>
                                <th>Context Window</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in perplexity_models %}
                            <tr>
                                <td><code>{{ model.id }}</code></td>
                                <td>{{ model.name }}</td>
                                <td>{{ model.context_window }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i> Perplexity API unavailable
                    {% if not api_keys.perplexity %}
                    <p class="mb-0 mt-2">An API key for Perplexity needs to be configured.</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Anthropic Models -->
    <div class="tab-pane fade" id="anthropic" role="tabpanel" aria-labelledby="anthropic-tab">
        <h4 class="mb-4">Anthropic Models</h4>
        <div class="row">
            <div class="col-12">
                {% if api_status.anthropic and anthropic_models %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Model ID</th>
                                <th>Display Name</th>
                                <th>Context Window</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in anthropic_models %}
                            <tr>
                                <td><code>{{ model.id }}</code></td>
                                <td>{{ model.name }}</td>
                                <td>{{ model.context_window }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i> Anthropic API unavailable
                    {% if not api_keys.anthropic %}
                    <p class="mb-0 mt-2">An API key for Anthropic needs to be configured.</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Mistral Models -->
    <div class="tab-pane fade" id="mistral" role="tabpanel" aria-labelledby="mistral-tab">
        <h4 class="mb-4">Mistral Models</h4>
        <div class="row">
            <div class="col-12">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i> Mistral API integration not implemented yet
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="tab-pane fade" id="performance" role="tabpanel" aria-labelledby="performance-tab">
        <h4 class="mb-4">Model Performance Metrics</h4>
        <div class="row">
            <div class="col-12">
                {% if model_performance %}
                <div class="table-responsive">
                    <table class="table table-hover table-striped">
                        <thead>
                            <tr>
                                <th>Model ID</th>
                                <th>Provider</th>
                                <th>Success Rate</th>
                                <th>Avg. Latency</th>
                                <th>Quality Score</th>
                                <th>Total Calls</th>
                                <th>Capabilities</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in model_performance %}
                            <tr>
                                <td><code>{{ model.model_id }}</code></td>
                                <td>{{ model.provider }}</td>
                                <td>{{ "%.2f"|format(model.success_rate * 100) }}%</td>
                                <td>{{ "%.2f"|format(model.average_latency) }}s</td>
                                <td>{{ "%.2f"|format(model.average_quality * 100) }}%</td>
                                <td>{{ model.total_calls }}</td>
                                <td>{{ model.capabilities }}</td>
                                <td>
                                    {% if model.is_current %}
                                    <span class="badge bg-primary">Current</span>
                                    {% else %}
                                    <span class="badge bg-secondary">Backup</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i> No performance metrics available yet
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Collaborative Model Selection -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Collaborative Model Selection Strategy</h5>
            </div>
            <div class="card-body">
                <p>Configure how models are selected based on query characteristics:</p>
                
                <form method="post" action="/admin/update-strategy">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Code Generation Queries</label>
                            <select class="form-select" name="code_model">
                                <option value="mistral-31-24b" {% if strategy.code_model == "mistral-31-24b" %}selected{% endif %}>Mistral 31B</option>
                                <option value="llama-3.1-sonar-small-128k-online" {% if strategy.code_model == "llama-3.1-sonar-small-128k-online" %}selected{% endif %}>Perplexity Llama 3 Small</option>
                                <option value="claude-3.5-sonnet-20241022" {% if strategy.code_model == "claude-3.5-sonnet-20241022" %}selected{% endif %}>Claude 3.5 Sonnet</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Text Generation Queries</label>
                            <select class="form-select" name="text_model">
                                <option value="mistral-31-24b" {% if strategy.text_model == "mistral-31-24b" %}selected{% endif %}>Mistral 31B</option>
                                <option value="llama-3.1-sonar-small-128k-online" {% if strategy.text_model == "llama-3.1-sonar-small-128k-online" %}selected{% endif %}>Perplexity Llama 3 Small</option>
                                <option value="claude-3.5-sonnet-20241022" {% if strategy.text_model == "claude-3.5-sonnet-20241022" %}selected{% endif %}>Claude 3.5 Sonnet</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Image Description Tasks</label>
                            <select class="form-select" name="image_model">
                                <option value="stable-diffusion-xl-1024-v1-0" {% if strategy.image_model == "stable-diffusion-xl-1024-v1-0" %}selected{% endif %}>Stable Diffusion XL</option>
                                <option value="claude-3-opus-20240229" {% if strategy.image_model == "claude-3-opus-20240229" %}selected{% endif %}>Claude 3 Opus (Vision)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="useDynamicRouting" name="use_dynamic_routing" {% if strategy.use_dynamic_routing %}checked{% endif %}>
                                <label class="form-check-label" for="useDynamicRouting">Enable dynamic query routing</label>
                            </div>
                            <small class="text-muted">When enabled, the system will automatically analyze queries and select the best model</small>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="useCollaboration" name="use_collaboration" {% if strategy.use_collaboration %}checked{% endif %}>
                                <label class="form-check-label" for="useCollaboration">Enable model collaboration</label>
                            </div>
                            <small class="text-muted">When enabled, multiple models may be consulted for a single query</small>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Save Strategy Settings</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Keep tab selection on page refresh
    const activeTab = localStorage.getItem('activeModelTab');
    if (activeTab) {
        const tab = document.querySelector(`#modelTabs button[data-bs-target="${activeTab}"]`);
        if (tab) {
            const bsTab = new bootstrap.Tab(tab);
            bsTab.show();
        }
    }
    
    // Save active tab to localStorage
    const tabLinks = document.querySelectorAll('#modelTabs button');
    tabLinks.forEach(link => {
        link.addEventListener('shown.bs.tab', event => {
            const target = event.target.getAttribute('data-bs-target');
            localStorage.setItem('activeModelTab', target);
        });
    });
});
</script>
{% endblock %}